(globalThis.webpackChunkdim=globalThis.webpackChunkdim||[]).push([[747],{30671:(e,t,n)=>{n.d(t,{Ot:()=>i,Sp:()=>c,fZ:()=>a,n1:()=>s,q6:()=>r,sZ:()=>o});const r=e=>e.accounts.accounts,o=e=>e.accounts.currentAccountMembershipId?r(e).find((t=>t.membershipId===e.accounts.currentAccountMembershipId&&t.destinyVersion===e.accounts.currentAccountDestinyVersion)):void 0,s=e=>e.accounts.currentAccountMembershipId,i=e=>e.accounts.currentAccountDestinyVersion??2,a=e=>e.accounts.loaded||e.accounts.loadedFromIDB&&r(e).length>0,c=e=>r(e).some((e=>1===e.destinyVersion))},10303:(e,t,n)=>{n.d(t,{E6:()=>i,Lq:()=>r,NZ:()=>a,S1:()=>o,nJ:()=>s});const r="2b16c291fcff48cbac86bd5f1d0bbc9d";function o(e,t){return{method:"POST",url:"https://www.bungie.net"+e,body:t}}function s(e,t){return{method:"GET",url:"https://www.bungie.net"+e,params:t}}function i(){return"13706"}function a(){return"G2fZXNyor2V466PgmmWoGVfeOS4oE6xQjzaokcvalFI"}},40768:(e,t,n)=>{n.d(t,{F9:()=>s,N1:()=>l,TL:()=>a,YX:()=>i,p4:()=>c,uT:()=>u});var r=n(69063),o=n(73618);class s extends Error{status;responseBody;constructor(e,t){super(t??e.statusText),this.status=e.status,this.responseBody=t}}async function i(e){try{const t=await e.text();return new s(e,t)}catch{return new s(e)}}class a extends Error{code;status;endpoint;constructor(e,t){super(e.Message??"Unknown Bungie Error"),this.name="BungieError",this.code=e.ErrorCode,this.status=e.ErrorStatus,this.endpoint=t.url}}function c(e,t,n){return async(...[r,o])=>{const s=Date.now(),i=setTimeout((()=>n(s,t)),t);try{return await e(r,o)}finally{void 0!==i&&clearTimeout(i)}}}function u(e,t){return async n=>{let o=n.url;n.params&&(o=`${o}?${""+new URLSearchParams(n.params)}`);const s=new Request(o,{method:n.method,body:n.body?JSON.stringify(n.body):void 0,headers:{"X-API-Key":t,...n.body?{"Content-Type":"application/json"}:void 0},credentials:"omit"}),c=await e(s);let u,d;try{u=await c.json()}catch(e){d=(0,r.n)(e)}if(function(e,t){if(!e||"object"!=typeof e)return e;const n="error"in e&&"error_description"in e&&e.error_description;if(n)throw new a({Message:n,ErrorCode:1618,ErrorStatus:n},t);if("ErrorCode"in e&&1!==e.ErrorCode)throw new a(e,t)}(u,s),await async function(e){if(e.status<200||e.status>=400)throw await i(e)}(c),d)throw d;return u}}let d=0;function l(e,t){return async n=>{if(d>0){const e=Math.min(3e5,500*Math.pow(2,d));t(d,e,n.url),await(0,o.c)(e)}try{const t=await e(n);return d=Math.floor(d/2),t}catch(e){if(e instanceof a)switch(e.code){case 35:case 36:case 37:case 1672:case 54:case 55:case 56:case 57:d++}throw e}}}},87362:(e,t,n)=>{n.d(t,{WG:()=>s,XM:()=>a,eF:()=>i,gf:()=>o,kz:()=>c,vv:()=>u});const r="authorization";function o(){const e=localStorage.getItem(r);return e?JSON.parse(e):null}function s(e){localStorage.setItem(r,JSON.stringify(e))}function i(){localStorage.removeItem(r)}function a(){const e=o();return!!e&&e&&!u(e.refreshToken)}function c(){const e=o();e&&(e.accessToken.inception=0,e.accessToken.expires=0,s(e))}function u(e){if(!e)return!0;const t=function(e){return e&&"inception"in e&&"expires"in e?e.inception+1e3*e.expires:0}(e);return Date.now()>t}},76955:(e,t,n)=>{n.d(t,{_:()=>u,x:()=>d});var r=n(95840),o=n(73618),s=n(10303),i=n(40768),a=n(87362);const c="https://www.bungie.net/platform/app/oauth/token/",u=(0,o.P)((async e=>{const t=new URLSearchParams({grant_type:"refresh_token",refresh_token:e.value,client_id:(0,s.E6)(),client_secret:(0,s.NZ)()}),n=await fetch(c,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(n.ok){const e=l(await n.json());return(0,a.WG)(e),(0,r.zh)("bungie auth","Successfully updated auth token from refresh token."),e}throw await(0,i.YX)(n)}));async function d(e){const t=new URLSearchParams({grant_type:"authorization_code",code:e,client_id:(0,s.E6)(),client_secret:(0,s.NZ)()}),n=await fetch(c,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(n.ok)return l(await n.json());throw await(0,i.YX)(n)}function l(e){if(e?.access_token){const t=e,n=Date.now(),r={accessToken:{value:t.access_token,expires:t.expires_in,name:"access",inception:n},bungieMembershipId:t.membership_id};return t.refresh_token&&(r.refreshToken={value:t.refresh_token,expires:t.refresh_expires_in,name:"refresh",inception:n}),r}throw Error("No data or access token in response: "+JSON.stringify(e))}},58379:(e,t,n)=>{n.d(t,{x:()=>r});class r extends Error{table;id;constructor(e,t){super(`hashLookupFailure: ${e}[${t}]`),this.table=e,this.id=t,this.name="HashLookupFailure"}}},19654:(e,t,n)=>{n.d(t,{$f:()=>l,$m:()=>a,A2:()=>u,Bz:()=>p,Dt:()=>g,E5:()=>S,_t:()=>w,b8:()=>y,eH:()=>b,i$:()=>m,md:()=>f,qg:()=>h,t2:()=>c,un:()=>i,x8:()=>d});var r=n(24367),o=n(30671),s=n(63150);function i(e){return a(e.membershipId,e.destinyVersion)}function a(e,t){return`${e}-d${t}`}const c=e=>e.dimApi.settings,u=e=>t=>t.dimApi.settings[e],d=(0,s.Mz)((e=>c(e).loParameters),(e=>({...r.KJ,...e}))),l=e=>c(e).loStatConstraintsByClass,f=e=>c(e).language,p=e=>t=>c(t).collapsedSections[e],h=e=>c(e).customStats,m=e=>!0===e.dimApi.apiPermissionGranted,g=e=>e.dimApi.profileLoadedError,w=e=>e.dimApi.updateQueue.length,b=(0,s.Mz)(o.sZ,(e=>e.dimApi.profiles),((e,t)=>e?t[i(e)]:void 0)),v=(0,s.Mz)((e=>e.dimApi.searches[(0,o.Ot)(e)]),((e,t)=>t),((e,t)=>e.filter((e=>(e.type??1)===t)))),y=e=>t=>v(t,e),S=(0,s.Mz)(b,(e=>e?.triumphs||[]))},43788:(e,t,n)=>{n.d(t,{Ki:()=>S,MN:()=>B,N0:()=>j,eG:()=>k,xt:()=>T});var r=n(572),o=n(65571),s=n(8938);const i=n.p+"de-3433f6f4.json",a=n.p+"en-740c347b.json",c=n.p+"es-ce5f2d76.json",u=n.p+"esMX-0d4320e0.json",d=n.p+"fr-d699aefe.json",l=n.p+"it-991afd57.json",f=n.p+"ja-b3aea920.json",p=n.p+"ko-439f1fc1.json",h=n.p+"pl-48b54299.json",m=n.p+"ptBR-fb7af604.json",g=n.p+"ru-df87a81b.json",w=n.p+"zhCHS-90c6bd82.json",b=n.p+"zhCHT-43b319eb.json";var v=n(19654),y=n(36871);const S={de:{pluralOverride:!1,latinBased:!0},en:{pluralOverride:!1,latinBased:!0},es:{pluralOverride:!1,latinBased:!0},"es-mx":{pluralOverride:!1,latinBased:!0},fr:{pluralOverride:!1,latinBased:!0},it:{pluralOverride:!1,latinBased:!0},ja:{pluralOverride:!0,latinBased:!1},ko:{pluralOverride:!0,latinBased:!1},pl:{pluralOverride:!0,latinBased:!0},"pt-br":{pluralOverride:!1,latinBased:!0},ru:{pluralOverride:!0,latinBased:!1},"zh-chs":{pluralOverride:!0,latinBased:!1},"zh-cht":{pluralOverride:!0,latinBased:!1}},E=Object.keys(S),B={"zh-Hans":"zh-chs","zh-Hant":"zh-cht"},O=(0,y.B8)(B);function x(){const e=window.navigator.language||"en",t=Object.entries(B).find((([t])=>e.startsWith(t)));return t?t[1]:E.find((t=>e.toLowerCase().startsWith(t)))||"en"}function k(){const e=localStorage.getItem("dimLanguage");return e&&E.includes(e)?e:x()}function T(){const e=k();return new Promise(((t,n)=>{o.Ay.use(s.A).init({initImmediate:!0,compatibilityJSON:"v3",debug:!1,lng:e,fallbackLng:"en",lowerCaseLng:!0,supportedLngs:E,load:"currentOnly",interpolation:{escapeValue:!1,format(e,t){switch(t){case"pct":return Math.min(100,Math.floor(100*parseFloat(e)))+"%";case"humanBytes":return function(e){if(e<=0)return"0B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)} ${["B","KB","MB","GB","TB"][t]}`}(parseInt(e,10));case"number":return parseInt(e,10).toLocaleString();default:return e}}},backend:{loadPath([e]){const t={de:i,en:a,es:c,"es-mx":u,fr:d,it:l,ja:f,ko:p,pl:h,"pt-br":m,ru:g,"zh-chs":w,"zh-cht":b}[e];if(!t)throw Error("unsupported language "+e);return t}},returnObjects:!0},(e=>{e?n(e):t(void 0)}));for(const e of E)S[e]?.pluralOverride&&o.Ay.services.pluralResolver.addRule(e,o.Ay.services.pluralResolver.getRule("en"))}))}function j(){return{id:"i18n-observer",getObserved:v.md,runInitially:!0,sideEffect:({current:e})=>{e===x()?localStorage.removeItem("dimLanguage"):localStorage.setItem("dimLanguage",e),e!==o.Ay.language&&o.Ay.changeLanguage(e),(0,r.NA)("lang",e),document.querySelector("html").setAttribute("lang",O[e]??e)}}}},2290:(e,t,n)=>{n.d(t,{t:()=>o,tl:()=>s});var r=n(65571);const o=(e,t)=>(0,r.t)(e,t);function s(e){return e}},36871:(e,t,n)=>{function r(e,t){return e.reduce(((e,n)=>t(n)?e+1:e),0)}function o(e,t){const n=[];for(let r=0;r<e.length;r++){const o=t(e[r],r);void 0!==o&&n.push(o)}return n}function s(e,t){return e.reduce(((e,n)=>{const r=n[t];for(const t of r)e[t]=n;return e}),{})}n.d(t,{B8:()=>f,Im:()=>u,LG:()=>l,LV:()=>i,U9:()=>r,Yb:()=>c,_:()=>p,_h:()=>h,hS:()=>a,oE:()=>d,x1:()=>o,xu:()=>m,z$:()=>s}),n(73016),n(97990),n(90383),n(53094),n(93997),n(33650),n(76060);const i=(e,t)=>{for(;e<0;)e+=t;for(;e>=t;)e-=t;return e};function a(e,t){const n=new Set,r=[];for(const o of e){const e=t(o);n.has(e)||(r.push(o),n.add(e))}return r}function c(e,t,n){const r=Array.from(e),[o]=r.splice(t,1);return r.splice(n,0,o),r}function u(e){if(!e)return!0;for(const t in e)return!1;return!0}function d(e){return e.filter((e=>e))}function l(e,t){return Object.entries(e).reduce(((e,[n,r])=>{if(void 0===r)return e;const o=t(r,n);return void 0!==o&&(e[n]=o),e}),{})}function f(e,t){return Object.entries(e).reduce(((e,[n,r])=>{if(void 0!==r){const o=t?t(n):n;void 0!==o&&(e[r]=o)}return e}),{})}function p(e,t){let n=-1/0;for(const r of e){const e=t(r);e>n&&(n=e)}return n}function h(e,t){let n=1/0;for(const r of e){const e=t(r);e<n&&(n=e)}return n}function m(e,t){return e.reduce(((e,n)=>e+t(n)),0)}},50507:(e,t,n)=>{n.d(t,{X:()=>i});var r=n(40768),o=n(2290),s=n(69063);class i extends Error{code;cause;showSocials=!0;constructor(e,t){super(t||(0,o.t)(e)),this.code=e,this.name="DimError"}withError(e){return this.cause=(0,s.n)(e),this}withNoSocials(){return this.showSocials=!1,this}bungieErrorCode(){return this.cause instanceof r.TL?this.cause.code:this.cause instanceof i?this.cause.bungieErrorCode():void 0}}},69063:(e,t,n)=>{function r(e){return e instanceof Error?e.message:JSON.stringify(e)}function o(e){return e instanceof Error?e:Error(JSON.stringify(e))}n.d(t,{g:()=>r,n:()=>o})},95840:(e,t,n)=>{function r(e,t,...n){console.log(`[${e}]`,t,...n)}function o(e,t,...n){console.warn(`[${e}]`,t,...n)}function s(e,t,...n){console.groupCollapsed(`[${e}]`,t),console.warn(`[${e}]`,t,...n),console.groupEnd()}function i(e,t,...n){console.error(`[${e}]`,t,...n)}function a(e,t){const n=`[${e}] ${t}`;return console.time(n),()=>console.timeEnd(n)}n.d(t,{O1:()=>a,PT:()=>i,XX:()=>o,i3:()=>s,zh:()=>r})},73618:(e,t,n)=>{function r(e){let t=null;return async(...n)=>{if(t)return t;t=e(...n);try{return await t}finally{t=null}}}function o(e){return new Promise((t=>setTimeout(t,e)))}n.d(t,{P:()=>r,c:()=>o})},44155:(e,t,n)=>{n.d(t,{U:()=>m});var r=n(15086),o=n(39744),s=n(572),i=n(79279),a=n(40768),c=n(87362),u=n(58379),d=n(43788),l=n(50507);const f=["BungieService.SlowResponse","BungieService.Difficulties","BungieService.Throttled","BungieService.Maintenance","BungieService.NotConnected","BungieService.NotConnectedOrBlocked","ItemService.ExoticError",1671],p={enabled:!0,dsn:"https://1367619d45da481b8148dd345c1a1330@sentry.io/279673",release:"8.50.0.3686",environment:"beta",ignoreErrors:[],sampleRate:.01,attachStacktrace:!0,tracePropagationTargets:["https://api.destinyitemmanager.com"],integrations:[(0,r.dp)({beforeStartSpan:e=>({...e,name:window.location.pathname.replace(/\/\d+\/d(1|2)/g,"/profileMembershipId/d$1").replace(/\/vendors\/\d+/g,"/vendors/vendorId").replace(/index\.html/,"")})})],tracesSampleRate:.001,beforeSend:(e,t)=>{const n=t?.originalException,r=n instanceof l.X?n.cause:void 0,o=r instanceof a.TL?r.code:n instanceof l.X?n.code:void 0;if(o&&f.includes(o))return null;if(n instanceof u.x&&(e.fingerprint=["{{ default }}",n.table+"",n.id+""]),n instanceof l.X){let t=n.code;if(n.bungieErrorCode()&&(t=`${t} (${n.bungieErrorCode()})`),e.message=t,e.exception?.values)for(const r of e.exception.values)r.value===n.message&&(r.value=t);e.tags={...e.tags,code:n.code},r instanceof a.TL&&(e.tags={...e.tags,bungieErrorCode:r.code}),r&&(e.extra={...e.extra,cause:r})}return e}};(0,o.T)(p);const h=(0,c.gf)();h?.bungieMembershipId&&(0,s.gV)({id:h.bungieMembershipId}),(0,s.NA)("lang",(0,d.eG)());const m=(e,t,n)=>{(0,i.v4)((r=>{(0,s.NA)("context",e),n&&r.setExtras(n),(0,s.Cp)(t)}))}}}]);
//# sourceMappingURL=747-66af96e8.js.map